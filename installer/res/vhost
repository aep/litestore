<VirtualHost *:80>

    DocumentRoot "/home/<<RSTI_UNIXUSER>>/html/restore/app"

    ServerName <<RSTI_DOMAIN>>
    ServerAlias www.<<RSTI_DOMAIN>>



    RewriteEngine on

    RewriteRule  ^/admin/export/(.*)\.csv$            /admin/export.php?format=csv&scheme=$1 [PT]
    RewriteRule  ^/admin/export/(.*)\.xml$            /admin/export.php?format=xml&scheme=$1 [PT]

    Alias /templates        /home/<<RSTI_UNIXUSER>>/html/restore/templates
    Alias /images           /home/<<RSTI_UNIXUSER>>/html/restore/images
    Alias /admin/images     /home/<<RSTI_UNIXUSER>>/html/restore/admin/images
    Alias /admin            /home/<<RSTI_UNIXUSER>>/html/restore/admin
    Alias /javascript       /home/<<RSTI_UNIXUSER>>/html/restore/app/includes/javascript


    RewriteRule  ^/search?(.*)$                             /advanced_search_result.php?%{QUERY_STRING}
    RewriteRule  ^/search/(.*)$                             /advanced_search_result.php?keywords=$1
    RewriteRule  ^/login$                                   /login.php
    RewriteRule  ^/logout$                                  /logoff.php
    RewriteRule  ^/myaccount$                               /account.php
    RewriteRule  ^/checkout/?$                              /checkout_shipping.php?%{QUERY_STRING}
    RewriteRule  ^/mycart/?\w*$                             /shopping_cart.php?%{QUERY_STRING}
    RewriteRule  ^/catalog/?$                               /catalog.php?%{QUERY_STRING}
    RewriteRule  ^/catalog/(\d*)$                           /catalog.php?cPath=$1&%{QUERY_STRING}
    RewriteRule  ^/catalog/(\d*)/(\d*)$                     /catalog.php?cPath=$1_$2&%{QUERY_STRING}
    RewriteRule  ^/catalog/(\d*)/(\d*)/(\d*)$               /catalog.php?cPath=$1_$2_$3&%{QUERY_STRING}
    RewriteRule  ^/catalog/(\d*)/(\d*)/(\d*)/(\d*)$         /catalog.php?cPath=$1_$2_$3_$4&%{QUERY_STRING}
    RewriteRule  ^/catalog/(\d*)/(\d*)/(\d*)/(\d*)/(\d*)$   /catalog.php?cPath=$1_$2_$3_$4_$5&%{QUERY_STRING}
    RewriteRule  ^/content/(\w+).*$                         /content.php?coID=$1
    RewriteRule  ^/products/(\d+)/?.*$                      /product_info.php?info=p$1&%{QUERY_STRING}


    #allow the aliased access
    <Directory /home/<<RSTI_UNIXUSER>>/html/ >
            AllowOverride None
            Options Indexes
            Order Allow,Deny
            Allow from all
    </Directory>


    #enable php execution in the app directory

    <Directory /home/<<RSTI_UNIXUSER>>/html/restore/app/ >
        DirectoryIndex index.php index.html
        AddHandler application/x-httpd-php .php
    </Directory>
    <Directory /home/<<RSTI_UNIXUSER>>/html/restore/admin >
        DirectoryIndex index.php index.html
        AddHandler application/x-httpd-php .php
    </Directory>


    #disable execution for and deny access to subdirectories

    <Directory /home/<<RSTI_UNIXUSER>>/html/restore/app/* >
        DirectoryIndex index.html
        RemoveHandler .php
        Order Deny,Allow
        Deny from all
    </Directory>
    <Directory /home/<<RSTI_UNIXUSER>>/html/restore/admin/* >
        DirectoryIndex index.html
        RemoveHandler .php
        Order Deny,Allow
        Deny from all
    </Directory>
    <Directory /home/<<RSTI_UNIXUSER>>/html/restore/admin/images/ >
        Order Allow,Deny
        Allow from all
    </Directory>
    <Directory  /home/<<RSTI_UNIXUSER>>/html/restore/admin/includes/fm >
        Order Allow,Deny
        Allow from all
    </Directory>

    #javascript
    <Directory /home/<<RSTI_UNIXUSER>>/html/restore/app/includes/javascript/ >
        Order Allow,Deny
        Allow from all
    </Directory>

</VirtualHost>
